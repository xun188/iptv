<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IPA 签名管理 - Wodane</title>
    <!-- 直接使用 Tailwind CDN 进行快速开发 -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 引入 Lucide 图标 -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; }
    </style>
</head>
<body class="bg-slate-50 text-slate-800 min-h-screen flex flex-col items-center justify-center p-4">

    <div id="app" class="w-full max-w-md bg-white rounded-[2.5rem] shadow-2xl p-10 border border-slate-100 text-center">
        <div class="w-20 h-20 bg-blue-50 text-blue-600 rounded-3xl flex items-center justify-center mx-auto mb-6">
            <i data-lucide="file-up" class="w-10 h-10"></i>
        </div>
        
        <h1 class="text-3xl font-black tracking-tighter mb-2">IPA 签名管理</h1>
        <p class="text-slate-400 text-xs font-bold uppercase tracking-widest mb-8">独立子系统</p>

        <div id="status-box" class="bg-slate-50 p-4 rounded-2xl text-left mb-8 border border-slate-100 text-sm font-mono text-slate-500">
            检测登录状态...
        </div>

        <div class="space-y-3">
            <button onclick="alert('功能开发中...')" class="w-full py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-xl font-bold transition shadow-lg shadow-blue-200">
                上传 IPA 文件
            </button>
            <button onclick="handleLogout()" class="w-full py-3 bg-slate-100 hover:bg-slate-200 text-slate-600 rounded-xl font-bold transition">
                退出登录
            </button>
        </div>
    </div>

    <script>
        // 初始化图标
        lucide.createIcons();

        // 1. 从 LocalStorage 获取主站的 Session
        const SESSION_KEY = "gallery_secure_v6_final";
        const sessionStr = localStorage.getItem(SESSION_KEY);
        
        let session = null;
        try {
            if (sessionStr) {
                session = JSON.parse(sessionStr);
                // 简单检查有效期 (2小时)
                if (Date.now() - session.time > 2 * 60 * 60 * 1000) {
                    throw new Error("会话已过期");
                }
            } else {
                throw new Error("未登录");
            }
        } catch (e) {
            // 未登录或过期，跳回主页进行登录
            window.location.href = "/"; 
        }

        // 2. 显示用户信息
        if (session) {
            const user = session.userProfile;
            const token = session.githubToken;
            const statusBox = document.getElementById('status-box');
            
            statusBox.innerHTML = `
                <p>用户: <span class="font-bold text-slate-700">${user.username}</span></p>
                <p>角色: <span class="font-bold text-slate-700">${user.role === 'admin' ? '管理员' : '访客'}</span></p>
                <p class="text-green-600 mt-2 flex items-center gap-1">
                    <i data-lucide="check" class="w-3 h-3"></i> Token 已就绪
                </p>
            `;
            lucide.createIcons(); // 刷新图标
            
            // TODO: 在这里编写你的 GitHub API 逻辑
            // const gh = new GitHubAPI(token); ...
        }

        // 3. 退出登录逻辑
        function handleLogout() {
            localStorage.removeItem(SESSION_KEY);
            window.location.href = "/";
        }
    </script>
</body>
</html>
